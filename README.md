# Qt_udp
Интерфейс общения с платой (микроконтроллер). Протокол был задан изначально, на уровне прошивки МК. 


+ 1) Чтение существующей прошивки и запись в файл, указанный пользователем (кнопка Read). Qt отправляет структуру 
typedef struct  {
    uint32_t size; - записываем размер
    uint32_t header; - не используем
    uint32_t command; - записываем команду 0001
    uint32_t addr; - записываем адрес
    uint8_t data[256]; - не используем

}data_struct;

Плата принимает структуру при команде 0001
typedef struct  {
	uint32_t send_size;
	uint32_t send_header;
	uint32_t send_data[256];

}send_data_struct;

Функция начала чтения - StartRead (здесь происходит присвоение переменных и запуск таймера для повторной отправки запроса чтения). 
Основная функция чтения CurrentRead отправляет запрос на чтение по 256 байт (256*4 бита), если данные успешно были прочитаны плата отправляет send_header=5 данные записываются в массив Qt arraPtr. После того, как все данные будут записаны Qt записывает данные в Hex файл папки C:\Qt\Qt5.12.9\Projects\UDP_test\ по 32 бита в строке. 
Ограничения на входные данные адреса (>=0) и размера (>0) указаны в справке дополнительного окна (значок ?) при нажатии кнопки Read.
Также организована повторная отправка пакета при равенстве адресов по истечении 3 секунд. 
 
       
+ 2) Запись прошивки из hex файла в память платы (кнопка Write). Qt отправляет структуру 
typedef struct  {
    uint32_t size; - записываем размер
    uint32_t header; - записываем заголовок 0010
    uint32_t command; - записываем команду 0010
    uint32_t addr; - записываем адрес
    uint8_t data[256]; - записываем данные

}data_struct;
Плата принимает структуру при команде 0010
typedef struct  {
	uint32_t send_size;
	uint32_t send_header;
	uint32_t send_data[256];

}send_data_struct;
Функция начала записи - Start_Writing (здесь происходит присвоение переменных, запуск таймера для повторной отправки запроса чтения и очищение сектора). 
Основная функция записи Data_writing отправляет запрос на запись по 256 байт (256*4 бита), если данные успешно были прочитаны плата отправляет send_header=2 данные записываются в прошивку платы. 
Ограничения на адрес сегмента при записи в прошивку и при очистке(>0x08010000). 
Также организована повторная отправка при равенстве размеров по истечении 3 секунд и при очистке, если плата не ответила об успешной очистке через 20 секунд. 

+ 3) По нажатию кнопки START Qt отправляет структуру 
typedef struct  {
    uint32_t size; - не используем 
    uint32_t header; - не используем 
    uint32_t command; - записываем команду 0011
    uint32_t addr; - записываем адрес
    uint8_t data[256]; - не используем 

}data_struct;

Плата выполняет функцию JumpToApplication, которая исполняет прошивку, записанную по указанному адресу.
Ограничения на входные данные адреса (>=0x08010000) указаны в справке дополнительного окна (значок ?).

+ 4) По нажатию кнопки Info Qt отправляет структуру 
typedef struct  {
    uint32_t size; - не используем 
    uint32_t header; - не используем 
    uint32_t command; - записываем команду 1111
    uint32_t addr; - не используем 
    uint8_t data[256]; - не используем 

}data_struct;

Плата выполняет функцию InfoCommandProcessing с заголовком 01 присылает сообщения udp_printf("STM32F405xx");
udp_printf("Version 1");.

+ 5) Копка STM_IP_Change позволяет сменить IP платы. Запись  Ip должна удовлетворять следующему регулярному выражению "[0-9]{3}\\.[0-9]{3}\\.[0-9]{1,3}\\.[0-9]{1,3}"

+ 6)Кнопка TextEditClear очищает текстовое поле формы Qt.



	






